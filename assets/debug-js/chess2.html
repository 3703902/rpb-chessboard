<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Sandbox for chess2.js</title>

	<!-- Tested component -->
	<script type="text/javascript" src="../../js/chess2.js"></script>

	<script type="text/javascript">

		/* global Chess2 */


		/**
		 * Number of tests performed.
		 */
		var testCounter = 0;

		/**
		 * Number of tests that succeed.
		 */
		var successCounter = 0;


		/**
		 * Refresh the global counters.
		 */
		function refreshCounters() {
			'use strict';
			var div1 = document.getElementById('testCounter');
			div1.innerHTML = '';
			div1.appendChild(document.createTextNode(testCounter + ' tests performed.'));
			var div2 = document.getElementById('successCounter');
			div2.innerHTML = '';
			if(testCounter===successCounter) {
				div2.appendChild(document.createTextNode('All tests were successful.'));
				div2.className = 'allSuccessful';
			}
			else {
				div2.appendChild(document.createTextNode((testCounter-successCounter) + ' tests failed.'));
				div2.className = 'someFailure';
			}
		}


		/**
		 * Base report method.
		 */
		function printMessage(success, message) {
			'use strict';
			var div = document.createElement('div');
			div.className = 'message ' + (success ? 'success' : 'failure');
			div.appendChild(document.createTextNode(message));
			document.getElementById('report').appendChild(div);
		}


		/**
		 * Report that a test succeeded.
		 */
		function printSuccess(label) {
			'use strict';
			printMessage(true, label);
		}


		/**
		 * Print an error message to report that an tested function did not returned what was expected.
		 */
		function printBadValue(label, observedValue, expectedValue) {
			'use strict';

			var message = label + ' => observed >>' + observedValue + '<<';
			if(typeof expectedValue === 'undefined') {
				message += ' while error expected';
			}
			else {
				message += ' while expected >>' + expectedValue + '<<';
			}
			printMessage(false, message);
		}


		/**
		 * Print an error message to report that an exception was thrown during a test.
		 */
		function printException(label, exception) {
			'use strict';

			var message = label + ' => ';
			if(exception instanceof Chess2.exceptions.IllegalArgument) {
				message += 'illegal argument in ' + exception.fun;
			}
			else if(exception instanceof Chess2.exceptions.InvalidFEN) {
				message += 'bad FEN >>' + exception.fen + '<< => ' + exception.message;
			}
			else {
				message += 'unknown exception => ' + exception;
			}
			printMessage(false, message);
		}


		/**
		 * Check the returned value of a function.
		 */
		function test(label, fun, expectedValue) {
			'use strict';
			try {
				++testCounter;
				var observedValue = fun();
				if(observedValue === expectedValue) {
					++successCounter;
					printSuccess(label);
				}
				else {
					printBadValue(label, observedValue, expectedValue);
				}
			}
			catch(exception) {
				printException(label, exception);
			}
			refreshCounters();
		}


		/**
		 * Check the exception thrown by a function.
		 */
		function testError(label, fun, checkException) {
			'use strict';
			try {
				++testCounter;
				var observedValue = fun();
				printBadValue(label, observedValue);
			}
			catch(exception) {
				if(checkException(exception)) {
					++successCounter;
					printSuccess(label);
				}
				else {
					printException(label, exception);
				}
			}
			refreshCounters();
		}

	</script>

	<style type="text/css">
		#toolbar {
			display: flex;
			flex-direction: row;
			align-items: center;
		}
		#toolbar > * + * {
			margin-left: 15px;
		}
		#successCounter {
			font-weight: bold;
		}
		#successCounter.allSuccessful {
			color: #060;
		}
		#successCounter.someFailure {
			color: #b00;
		}
		#report {
			display: flex;
			flex-direction: column;
		}
		#report > * + * {
			margin-top: 5px;
		}
		.success {
			background-color: #cfc;
		}
		.failure {
			background-color: #fcc;
		}
		.message {
			font-family: monospace;
			white-space: pre-wrap;
			padding: 3px;
		}
	</style>

</head>

<body>
	<h1>Sandbox for chess2.js</h1>

	<div id="toolbar">
		<button type="button" id="run-unit-tests">Unit tests</button>
		<div id="testCounter"></div>
		<div id="successCounter"></div>
	</div>

	<hr/>

	<div id="report"></div>

	<script type="text/javascript">
		document.getElementById('run-unit-tests').onclick = function() {
			'use strict';

			// Generate a predicate to check that an exception is an illegal-argument exception issued by the right function.
			function checkIllegalArgument(fun) {
				return function(exception) {
					return (exception instanceof Chess2.exceptions.IllegalArgument) && (exception.fun === fun);
				};
			}

			// Generate a predicate to check that an exception is an invalid-FEN exception with the right message.
			function checkInvalidFEN(code) {

				// Build the error message
				var message = '<not an error message>';
				if(typeof code === 'undefined') {
					message = null;
				}
				else if(code in Chess2.i18n) {
					message = Chess2.i18n[code];
					for(var i=1; i<arguments.length; ++i) {
						var re = new RegExp('\\{' + i + '\\}');
						message = message.replace(re, arguments[i]);
					}
				}

				// Generate the predicate
				return function(exception) {
					return (exception instanceof Chess2.exceptions.InvalidFEN) && (message === null || message === exception.message);
				};
			}

			var startFEN   = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';
			var emptyFEN   = '8/8/8/8/8/8/8/8 w - - 0 1';
			var customFEN1 = 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b Kk e3 10 5';
			var customFEN2 = 'k7/n1PB4/1K6/8/8/8/8/8 w - - 0 60';

			var optsFEN1 = { fiftyMoveClock: 10, fullMoveNumber: 5 };
			var optsFEN2 = { fullMoveNumber: 60 };

			// Constructor
			test('Default constructor'    , function() { return (new Chess2.Position()).fen(); }, startFEN);
			test('Constructor \'start\''  , function() { return (new Chess2.Position('start')).fen(); }, startFEN);
			test('Constructor \'empty\''  , function() { return (new Chess2.Position('empty')).fen(); }, emptyFEN);
			test('Constructor FEN-based 1', function() { return (new Chess2.Position(customFEN1)).fen(optsFEN1); }, customFEN1);
			test('Constructor FEN-based 2', function() { return (new Chess2.Position(customFEN2)).fen(optsFEN2); }, customFEN2);
			test('Copy constructor', function() {
				var p1 = new Chess2.Position(customFEN1);
				var p2 = new Chess2.Position(p1);
				p1.clear();
				return p1.fen() + '|' + p2.fen(optsFEN1);
			}, emptyFEN + '|' + customFEN1);

			var customFEN3  = 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b Kq e3 0 1';
			var customFEN3a = 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b qK e3 0 1';
			var customFEN3b = 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b Kq e6 0 1';
			var customFEN3c = 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b Kq e3 00 1';

			// FEN strict
			test('Set FEN (tolerant) A', function() { var p=new Chess2.Position(); p.fen(customFEN3a); return p.fen(); }, customFEN3);
			test('Set FEN (tolerant) B', function() { var p=new Chess2.Position(); p.fen(customFEN3b); return p.fen(); }, customFEN3);
			test('Set FEN (tolerant) C', function() { var p=new Chess2.Position(); p.fen(customFEN3c); return p.fen(); }, customFEN3);
			test('Set FEN (strict) OK 1', function() { var p=new Chess2.Position(); p.fen(customFEN1, true); return p.fen(optsFEN1); }, customFEN1);
			test('Set FEN (strict) OK 2', function() { var p=new Chess2.Position(); p.fen(customFEN2, true); return p.fen(optsFEN2); }, customFEN2);
			test('Set FEN (strict) OK 3', function() { var p=new Chess2.Position(); p.fen(customFEN3, true); return p.fen(); }, customFEN3);
			testError('Set FEN (strict) NOK A', function() { var p=new Chess2.Position(); p.fen(customFEN3a, true); }, checkInvalidFEN('INVALID_CASTLE_RIGHTS_FIELD'));
			testError('Set FEN (strict) NOK B', function() { var p=new Chess2.Position(); p.fen(customFEN3b, true); }, checkInvalidFEN('WRONG_ROW_IN_EN_PASSANT_FIELD'));
			testError('Set FEN (strict) NOK C', function() { var p=new Chess2.Position(); p.fen(customFEN3c, true); }, checkInvalidFEN('INVALID_MOVE_COUNTING_FIELD', '5th'));

			function wrapCP(cp) {
				return (typeof cp === 'object') && ('piece' in cp) && ('color' in cp) ? (cp.color + ':' + cp.piece) : cp;
			}

			// Getters
			test('Getter board 1', function() { var p=new Chess2.Position(); return wrapCP(p.square('e1')); }, 'w:k');
			test('Getter board 2', function() { var p=new Chess2.Position(); return wrapCP(p.square('b4')); }, '-');
			test('Getter turn 1', function() { var p=new Chess2.Position(); return p.turn(); }, 'w');
			test('Getter turn 2', function() { var p=new Chess2.Position(customFEN1); return p.turn(); }, 'b');
			test('Getter castling 1', function() { var p=new Chess2.Position(); return p.castleRights('w', 'q'); }, true);
			test('Getter castling 2', function() { var p=new Chess2.Position(customFEN1); return p.castleRights('b', 'q'); }, false);
			test('Getter castling 3', function() { var p=new Chess2.Position(customFEN1); return p.castleRights('b', 'k'); }, true);
			test('Getter en-passant 1', function() { var p=new Chess2.Position(); return p.enPassant(); }, '-');
			test('Getter en-passant 2', function() { var p=new Chess2.Position(customFEN1); return p.enPassant(); }, 'e');
			testError('Getter board NOK'   , function() { var p=new Chess2.Position(); return wrapCP(p.square('j1')); }, checkIllegalArgument('Position#square()'));
			testError('Getter castling NOK', function() { var p=new Chess2.Position(); return p.castleRights('b', 'K'); }, checkIllegalArgument('Position#castleRights()'));

			var pos1 = new Chess2.Position('start');
			var pos2 = new Chess2.Position('empty');

			// Setters
			test('Setter board 1a', function() { pos1.square('a8', '-'); return pos1.fen(); }, '1nbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');
			test('Setter board 1b', function() { pos1.square('f6', {color:'w', piece:'b'}); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');
			test('Setter board 2a', function() { pos2.square('c3', {color:'b', piece:'k'}); return pos2.fen(); }, '8/8/8/8/8/2k5/8/8 w - - 0 1');
			test('Setter board 2b', function() { pos2.square('g5', {color:'w', piece:'k'}); return pos2.fen(); }, '8/8/8/6K1/8/2k5/8/8 w - - 0 1');
			test('Setter board 2c', function() { pos2.square('c3', '-'); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 w - - 0 1');
			test('Setter turn 1', function() { pos1.turn('w'); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');
			test('Setter turn 2', function() { pos2.turn('b'); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 b - - 0 1');
			test('Setter castling 1a', function() { pos1.castleRights('w', 'k', false); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w Qkq - 0 1');
			test('Setter castling 1b', function() { pos1.castleRights('b', 'k', true); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w Qkq - 0 1');
			test('Setter castling 2a', function() { pos2.castleRights('w', 'q', false); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 b - - 0 1');
			test('Setter castling 2b', function() { pos2.castleRights('b', 'q', true); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 b q - 0 1');
			test('Setter en-passant 1a', function() { pos1.enPassant('e'); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w Qkq e6 0 1');
			test('Setter en-passant 1b', function() { pos1.enPassant('-'); return pos1.fen(); }, '1nbqkbnr/pppppppp/5B2/8/8/8/PPPPPPPP/RNBQKBNR w Qkq - 0 1');
			test('Setter en-passant 2a', function() { pos2.enPassant('a'); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 b q a3 0 1');
			test('Setter en-passant 2b', function() { pos2.enPassant('h'); return pos2.fen(); }, '8/8/8/6K1/8/8/8/8 b q h3 0 1');

			var ROW    = '12345678';
			var COLUMN = 'abcdefgh';
			var PROMO  = ' BKNPQR';

			// Return the list of attacked squares in the given position
			function attacked(position, byWho, byWhat) {
				var res = '';
				for(var r=0; r<8; ++r) {
					for(var c=0; c<8; ++c) {
						var square = COLUMN[c] + ROW[r];
						if(position.isAttacked(square, byWho, byWhat)) {
							if(res !== '') { res += '/'; }
							res += square;
						}
					}
				}
				return res;
			}

			// Attacks
			test('King attacks 1', function() { var p=new Chess2.Position('8/8/8/4K3/8/8/8/8 w - - 0 1'); return attacked(p, 'w'); }, 'd4/e4/f4/d5/f5/d6/e6/f6');
			test('King attacks 2', function() { var p=new Chess2.Position('8/8/8/8/8/8/PPP5/K1P5 w - - 0 1'); return attacked(p, 'w', 'k'); }, 'b1/a2/b2');
			test('Queen attacks 1', function() { var p=new Chess2.Position('8/8/8/4q3/8/8/8/8 w - - 0 1'); return attacked(p, 'b'); }, 'a1/e1/b2/e2/h2/c3/e3/g3/d4/e4/f4/a5/b5/c5/d5/f5/g5/h5/d6/e6/f6/c7/e7/g7/b8/e8/h8');
			test('Queen attacks 2', function() { var p=new Chess2.Position('8/8/8/8/8/pppp4/3p4/q2p4 w - - 0 1'); return attacked(p, 'b', 'q'); }, 'b1/c1/d1/a2/b2/a3/c3');
			test('Rook attacks 1', function() { var p=new Chess2.Position('8/8/8/4R3/8/8/8/8 w - - 0 1'); return attacked(p, 'w'); }, 'e1/e2/e3/e4/a5/b5/c5/d5/f5/g5/h5/e6/e7/e8');
			test('Rook attacks 2', function() { var p=new Chess2.Position('8/8/8/8/8/PPPP4/3P4/R2P4 w - - 0 1'); return attacked(p, 'w', 'r'); }, 'b1/c1/d1/a2/a3');
			test('Bishop attacks 1', function() { var p=new Chess2.Position('8/8/8/4b3/8/8/8/8 w - - 0 1'); return attacked(p, 'b'); }, 'a1/b2/h2/c3/g3/d4/f4/d6/f6/c7/g7/b8/h8');
			test('Bishop attacks 2', function() { var p=new Chess2.Position('8/8/8/8/8/pppp4/3p4/b2p4 w - - 0 1'); return attacked(p, 'b', 'b'); }, 'b2/c3');
			test('Knight attacks 1', function() { var p=new Chess2.Position('8/8/8/4N3/8/8/8/8 w - - 0 1'); return attacked(p, 'w'); }, 'd3/f3/c4/g4/c6/g6/d7/f7');
			test('Knight attacks 2', function() { var p=new Chess2.Position('8/8/8/8/8/8/PPP5/NP6 w - - 0 1'); return attacked(p, 'w', 'n'); }, 'c2/b3');
			test('White pawn attacks', function() { var p=new Chess2.Position('8/8/8/4P3/8/8/8/8 w - - 0 1'); return attacked(p, 'w'); }, 'd6/f6');
			test('Black pawn attacks', function() { var p=new Chess2.Position('8/8/8/4p3/8/8/8/8 w - - 0 1'); return attacked(p, 'b'); }, 'd4/f4');

			function legalInfo(position) {
				return position.isLegal() + ':' + position.kingSquare('w') + ':' + position.kingSquare('b');
			}

			// Legality
			test('Legality starting position', function() { var p=new Chess2.Position(); return legalInfo(p); }, 'true:e1:e8');
			test('Legality kings OK'   , function() { var p=new Chess2.Position('k7/8/8/8/8/8/8/7K w - - 0 1'); return legalInfo(p); }, 'true:h1:a8');
			test('Legality missing WK' , function() { var p=new Chess2.Position('7k/8/8/8/8/8/8/8 w - - 0 1'); return legalInfo(p); }, 'false:-:h8');
			test('Legality missing BK' , function() { var p=new Chess2.Position('8/8/8/8/8/8/8/K7 w - - 0 1'); return legalInfo(p); }, 'false:a1:-');
			test('Legality too many WK', function() { var p=new Chess2.Position('4k3/8/8/8/8/8/8/K6K w - - 0 1'); return legalInfo(p); }, 'false:-:e8');
			test('Legality too many BK', function() { var p=new Chess2.Position('k6k/8/8/8/8/8/8/4K3 w - - 0 1'); return legalInfo(p); }, 'false:e1:-');
			test('Legality white is check 1', function() { var p=new Chess2.Position('4k3/8/8/8/8/2b5/8/4K3 w - - 0 1'); return legalInfo(p); }, 'true:e1:e8');
			test('Legality white is check 2', function() { var p=new Chess2.Position('4k3/8/8/8/8/2b5/8/4K3 b - - 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality black is check 1', function() { var p=new Chess2.Position('4k3/8/5N2/8/8/8/8/4K3 w - - 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality black is check 2', function() { var p=new Chess2.Position('4k3/8/5N2/8/8/8/8/4K3 b - - 0 1'); return legalInfo(p); }, 'true:e1:e8');
			test('Legality pawn on first/last row 1', function() { var p=new Chess2.Position('6p1/8/2k5/8/8/5K2/8/8 w - - 0 1'); return legalInfo(p); }, 'false:f3:c6');
			test('Legality pawn on first/last row 2', function() { var p=new Chess2.Position('3P4/8/5k2/8/8/2K5/8/8 w - - 0 1'); return legalInfo(p); }, 'false:c3:f6');
			test('Legality pawn on first/last row 3', function() { var p=new Chess2.Position('8/8/8/2k5/5K2/8/8/4p3 w - - 0 1'); return legalInfo(p); }, 'false:f4:c5');
			test('Legality pawn on first/last row 4', function() { var p=new Chess2.Position('8/8/8/5k2/2K5/8/8/1P6 w - - 0 1'); return legalInfo(p); }, 'false:c4:f5');
			test('Legality castling white 1', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/8/R3K2R w KQ - 0 1'); return legalInfo(p); }, 'true:e1:e7');
			test('Legality castling white 2', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/8/R3K3 w Q - 0 1'); return legalInfo(p); }, 'true:e1:e7');
			test('Legality castling white 3', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/8/4K2R w K - 0 1'); return legalInfo(p); }, 'true:e1:e7');
			test('Legality castling white 4', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/8/R3K3 w K - 0 1'); return legalInfo(p); }, 'false:e1:e7');
			test('Legality castling white 5', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/8/4K2R w Q - 0 1'); return legalInfo(p); }, 'false:e1:e7');
			test('Legality castling white 6', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/4K3/R7 w Q - 0 1'); return legalInfo(p); }, 'false:e2:e7');
			test('Legality castling white 7', function() { var p=new Chess2.Position('8/4k3/8/8/8/8/4K3/7R w K - 0 1'); return legalInfo(p); }, 'false:e2:e7');
			test('Legality castling black 1', function() { var p=new Chess2.Position('r3k2r/8/8/8/8/8/4K3/8 w kq - 0 1'); return legalInfo(p); }, 'true:e2:e8');
			test('Legality castling black 2', function() { var p=new Chess2.Position('r3k3/8/8/8/8/8/4K3/8 w q - 0 1'); return legalInfo(p); }, 'true:e2:e8');
			test('Legality castling black 3', function() { var p=new Chess2.Position('4k2r/8/8/8/8/8/4K3/8 w k - 0 1'); return legalInfo(p); }, 'true:e2:e8');
			test('Legality castling black 4', function() { var p=new Chess2.Position('r3k3/8/8/8/8/8/4K3/8 w k - 0 1'); return legalInfo(p); }, 'false:e2:e8');
			test('Legality castling black 5', function() { var p=new Chess2.Position('4k2r/8/8/8/8/8/4K3/8 w q - 0 1'); return legalInfo(p); }, 'false:e2:e8');
			test('Legality castling black 6', function() { var p=new Chess2.Position('r7/4k3/8/8/8/8/4K3/8 w q - 0 1'); return legalInfo(p); }, 'false:e2:e7');
			test('Legality castling black 7', function() { var p=new Chess2.Position('7r/4k3/8/8/8/8/4K3/8 w k - 0 1'); return legalInfo(p); }, 'false:e2:e7');
			test('Legality en-passant white 1', function() { var p=new Chess2.Position('4k3/pppppp1p/8/6p1/8/8/PPPPPPPP/4K3 w - g6 0 1'); return legalInfo(p); }, 'true:e1:e8');
			test('Legality en-passant white 2', function() { var p=new Chess2.Position('4k3/pppppp1p/8/6r1/8/8/PPPPPPPP/4K3 w - g6 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality en-passant white 3', function() { var p=new Chess2.Position('4k3/pppppp1p/6P1/6p1/8/8/8/4K3 w - g6 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality en-passant white 4', function() { var p=new Chess2.Position('4k3/ppppppPp/8/6p1/8/8/8/4K3 w - g6 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality en-passant black 1', function() { var p=new Chess2.Position('4k3/pppppppp/8/8/2P5/8/PP1PPPPP/4K3 b - c3 0 1'); return legalInfo(p); }, 'true:e1:e8');
			test('Legality en-passant black 2', function() { var p=new Chess2.Position('4k3/pppppppp/8/8/2B5/8/PP1PPPPP/4K3 b - c3 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality en-passant black 3', function() { var p=new Chess2.Position('4k3/8/8/8/2P5/2p5/8/4K3 b - c3 0 1'); return legalInfo(p); }, 'false:e1:e8');
			test('Legality en-passant black 4', function() { var p=new Chess2.Position('4k3/8/8/8/2P5/8/2p5/4K3 b - c3 0 1'); return legalInfo(p); }, 'false:e1:e8');

			// Square color
			function squareColors(asExpected) {
				var res = '';
				for(var r=0; r<8; ++r) {
					for(var c=0; c<8; ++c) {
						if(res !== '') { res += '/'; }
						res += asExpected ? (c%2 === r%2 ? 'b' : 'w') : Chess2.squareColor(COLUMN[c] + ROW[r]);
					}
				}
				return res;
			}
			test('Square color', function() { return squareColors(false); }, squareColors(true));

			// Look for legal moves in a given position
			function legalMoves(position) {
				var res = '' + position.isLegal();
				for(var cf=0; cf<8; ++cf) {
					for(var rf=0; rf<8; ++rf) {
						for(var ct=0; ct<8; ++ct) {
							for(var rt=0; rt<8; ++rt) {
								for(var promo=0; promo<PROMO.length; ++promo) {
									var move = COLUMN[cf] + ROW[rf] + COLUMN[ct] + ROW[rt] + (promo===0 ? '' : PROMO[promo]);
									if(position.isMoveLegal(move)) {
										res += '/' + move;
									}
								}
							}
						}
					}
				}
				return res;
			}

			// Generate the legal moves in a given position
			function generateMoves(position) {
				var res = '' + position.isLegal();
				var descriptors = position.moves();
				var moves = [];
				for(var i=0; i<descriptors.length; ++i) {
					moves.push(descriptors[i].toString());
				}
				moves.sort();
				for(var i=0; i<moves.length; ++i) {
					res += '/' + moves[i];
				}
				return res;
			}

			// Look for check/checkmate/stalemate
			function ccs(position) {
				if(position.isLegal()) {
					return position.isCheck() + ':' + position.isCheckmate() + ':' + position.isStalemate() + ':' + position.hasMove();
				}
				else {
					return '';
				}
			}

			var position1  = 'rnbqkbnr/pppp1ppp/8/1B2p3/4P3/8/PPPP1PPP/RNBQK1NR b KQkq - 0 1';
			var position2a = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R w KQ f6 0 1';
			var position2b = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R w K - 0 1';
			var position2c = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R w Q - 0 1';
			var position2d = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R b kq c3 0 1';
			var position2e = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R b k - 0 1';
			var position2f = 'r3k2r/8/8/5pP1/1pP5/8/8/R3K2R b q - 0 1';
			var position3a = 'r4rk1/1p3qb1/pB1p2pp/P3N3/R3R3/2P5/1P2Q1PP/7K b - - 0 29';
			var position3b = 'r4rk1/1p4b1/pB1p2pp/P3N3/R3R3/2P5/1P2Q1PP/5q1K w - - 1 29';
			var position3c = 'r4rk1/1p6/p2p2pp/P3b3/R3R3/2P5/1P2Q1PP/5qBK w - - 0 30';
			var position4a = 'r2q1rk1/6b1/p2p2b1/1p1Nn2p/4p2P/2P1N3/PP2BPQ1/R3K2R w KQ - 0 22';
			var position4b = '4qr2/r6k/p2p3b/1p1Nn2b/4Q2P/2P1N1R1/PP3P2/2K3R1 b - - 0 27';
			var position4c = '4qr1k/r7/p2p3b/1p1Nn2b/4QP1P/2P1N1R1/PP6/2K3R1 b - - 0 28';
			var position5a = 'k7/8/8/b7/8/p6p/P6P/R3K2R w KQ - 0 1';
			var position5b = 'k7/8/8/8/8/p2b3p/P6P/R3K2R w KQ - 0 1';
			var position5c = 'k7/8/8/8/8/p4b1p/P6P/R3K2R w KQ - 0 1';
			var position5d = 'k7/8/7b/8/8/p6p/P6P/R3K2R w KQ - 0 1';
			var position5e = 'k7/b7/8/8/8/p6p/P6P/R3K2R w KQ - 0 1';
			var position5f = 'k7/8/8/8/8/p6p/P6P/R2K3R w KQ - 0 1';
			var position6a = 'r3k2r/p6p/P6P/8/B7/8/8/K7 b kq - 0 1';
			var position6b = 'r3k2r/p6p/P2B3P/8/8/8/8/K7 b kq - 0 1';
			var position6c = 'r3k2r/p6p/P4B1P/8/8/8/8/K7 b kq - 0 1';
			var position6d = 'r3k2r/p6p/P6P/8/8/7B/8/K7 b kq - 0 1';
			var position6e = 'r3k2r/p6p/P6P/8/8/8/B7/K7 b kq - 0 1';
			var position6f = 'r2k3r/p6p/P6P/8/8/8/8/K7 b kq - 0 1';
			var position7a = '4k3/4P3/4K3/8/8/8/8/8 b - - 0 1';
			var position7b = '8/8/8/8/8/6k1/8/r5K1 w - - 0 1';

			var moves0a = 'true/a2a3/a2a4/b1a3/b1c3/b2b3/b2b4/c2c3/c2c4/d2d3/d2d4/e2e3/e2e4/f2f3/f2f4/g1f3/g1h3/g2g3/g2g4/h2h3/h2h4';
			var moves0b = 'true/b6a5/b6a6/b6c5/c7c8B/c7c8N/c7c8Q/c7c8R/d7a4/d7b5/d7c6/d7c8/d7e6/d7e8/d7f5/d7g4/d7h3';
			var moves0c = 'false';
			var moves1  = 'true/a7a5/a7a6/b7b6/b8a6/b8c6/c7c5/c7c6/d8e7/d8f6/d8g5/d8h4/e8e7/f7f5/f7f6/f8a3/f8b4/f8c5/f8d6/f8e7/g7g5/g7g6/g8e7/g8f6/g8h6/h7h5/h7h6';
			var moves2a = 'true/a1a2/a1a3/a1a4/a1a5/a1a6/a1a7/a1a8/a1b1/a1c1/a1d1/c4c5/e1c1/e1d1/e1d2/e1e2/e1f1/e1f2/e1g1/g5f6/g5g6/h1f1/h1g1/h1h2/h1h3/h1h4/h1h5/h1h6/h1h7/h1h8';
			var moves2b = 'true/a1a2/a1a3/a1a4/a1a5/a1a6/a1a7/a1a8/a1b1/a1c1/a1d1/c4c5/e1d1/e1d2/e1e2/e1f1/e1f2/e1g1/g5g6/h1f1/h1g1/h1h2/h1h3/h1h4/h1h5/h1h6/h1h7/h1h8';
			var moves2c = 'true/a1a2/a1a3/a1a4/a1a5/a1a6/a1a7/a1a8/a1b1/a1c1/a1d1/c4c5/e1c1/e1d1/e1d2/e1e2/e1f1/e1f2/g5g6/h1f1/h1g1/h1h2/h1h3/h1h4/h1h5/h1h6/h1h7/h1h8';
			var moves2d = 'true/a8a1/a8a2/a8a3/a8a4/a8a5/a8a6/a8a7/a8b8/a8c8/a8d8/b4b3/b4c3/e8c8/e8d7/e8d8/e8e7/e8f7/e8f8/e8g8/f5f4/h8f8/h8g8/h8h1/h8h2/h8h3/h8h4/h8h5/h8h6/h8h7';
			var moves2e = 'true/a8a1/a8a2/a8a3/a8a4/a8a5/a8a6/a8a7/a8b8/a8c8/a8d8/b4b3/e8d7/e8d8/e8e7/e8f7/e8f8/e8g8/f5f4/h8f8/h8g8/h8h1/h8h2/h8h3/h8h4/h8h5/h8h6/h8h7';
			var moves2f = 'true/a8a1/a8a2/a8a3/a8a4/a8a5/a8a6/a8a7/a8b8/a8c8/a8d8/b4b3/e8c8/e8d7/e8d8/e8e7/e8f7/e8f8/f5f4/h8f8/h8g8/h8h1/h8h2/h8h3/h8h4/h8h5/h8h6/h8h7';
			var moves3a = 'true/a8a7/a8b8/a8c8/a8d8/a8e8/d6d5/d6e5/f7a2/f7b3/f7c4/f7c7/f7d5/f7d7/f7e6/f7e7/f7e8/f7f1/f7f2/f7f3/f7f4/f7f5/f7f6/f8b8/f8c8/f8d8/f8e8/g6g5/g7e5/g7f6/g7h8/g8h7/g8h8/h6h5';
			var moves3b = 'true/b6g1/e2f1';
			var moves3c = 'true/a4a1/a4a2/a4a3/a4b4/a4c4/a4d4/b2b3/b2b4/c3c4/e2a6/e2b5/e2c2/e2c4/e2d1/e2d2/e2d3/e2e1/e2e3/e2f1/e2f2/e2f3/e2g4/e2h5/e4b4/e4c4/e4d4/e4e3/e4e5/e4f4/e4g4/e4h4/g2g3/g2g4/h2h3/h2h4';
			var moves4a = 'true/a1b1/a1c1/a1d1/a2a3/a2a4/b2b3/b2b4/c3c4/d5b4/d5b6/d5c7/d5e7/d5f4/d5f6/e1c1/e1d1/e1d2/e1f1/e1g1/e2b5/e2c4/e2d1/e2d3/e2f1/e2f3/e2g4/e2h5/e3c2/e3c4/e3d1/e3f1/e3f5/e3g4/f2f3/f2f4/g2e4/g2f1/g2f3/g2g1/g2g3/g2g4/g2g5/g2g6/g2h2/g2h3/h1f1/h1g1/h1h2/h1h3';
			var moves4b = 'true/e5g6/e8g6/f8f5/h5g6/h7h8';
			var moves4c = 'true/a6a5/a7a8/a7b7/a7c7/a7d7/a7e7/a7f7/a7g7/a7h7/b5b4/e5c4/e5c6/e5d3/e5d7/e5f3/e5f7/e5g4/e5g6/e8a8/e8b8/e8c6/e8c8/e8d7/e8d8/e8e6/e8e7/e8f7/e8g6/f8f4/f8f5/f8f6/f8f7/f8g8/h5d1/h5e2/h5f3/h5f7/h5g4/h5g6/h6f4/h6g5/h6g7';
			var moves5a = 'true/e1d1/e1e2/e1f1/e1f2';
			var moves5b = 'true/a1b1/a1c1/a1d1/e1c1/e1d1/e1d2/e1f2/h1f1/h1g1';
			var moves5c = 'true/a1b1/a1c1/a1d1/e1d2/e1f1/e1f2/e1g1/h1f1/h1g1';
			var moves5d = 'true/a1b1/a1c1/a1d1/e1d1/e1e2/e1f1/e1f2/e1g1/h1f1/h1g1';
			var moves5e = 'true/a1b1/a1c1/a1d1/e1c1/e1d1/e1d2/e1e2/e1f1/h1f1/h1g1';
			var moves5f = 'false';
			var moves6a = 'true/e8d8/e8e7/e8f7/e8f8';
			var moves6b = 'true/a8b8/a8c8/a8d8/e8c8/e8d7/e8d8/e8f7/h8f8/h8g8';
			var moves6c = 'true/a8b8/a8c8/a8d8/e8d7/e8f7/e8f8/e8g8/h8f8/h8g8';
			var moves6d = 'true/a8b8/a8c8/a8d8/e8d8/e8e7/e8f7/e8f8/e8g8/h8f8/h8g8';
			var moves6e = 'true/a8b8/a8c8/a8d8/e8c8/e8d7/e8d8/e8e7/e8f8/h8f8/h8g8';
			var moves6f = 'false';
			var moves7  = 'true';

			var ccsCheckmate = 'true:true:false:false';
			var ccsCheck     = 'true:false:false:true';
			var ccsStalemate = 'false:false:true:false';
			var ccsNormal    = 'false:false:false:true';
			var ccsIllegal   = '';

			// Move verification
			testError('Move legality bad-format 1', function() { var p=new Chess2.Position(); return p.isMoveLegal('abcd'); }, checkIllegalArgument('Position#isMoveLegal()'));
			test('Move legality 0a', function() { var p=new Chess2.Position(          ); return legalMoves(p); }, moves0a);
			test('Move legality 0b', function() { var p=new Chess2.Position(customFEN2); return legalMoves(p); }, moves0b);
			test('Move legality 0c', function() { var p=new Chess2.Position('empty'   ); return legalMoves(p); }, moves0c);
			test('Move legality 1' , function() { var p=new Chess2.Position(position1 ); return legalMoves(p); }, moves1 );
			test('Move legality 2a', function() { var p=new Chess2.Position(position2a); return legalMoves(p); }, moves2a);
			test('Move legality 2b', function() { var p=new Chess2.Position(position2b); return legalMoves(p); }, moves2b);
			test('Move legality 2c', function() { var p=new Chess2.Position(position2c); return legalMoves(p); }, moves2c);
			test('Move legality 2d', function() { var p=new Chess2.Position(position2d); return legalMoves(p); }, moves2d);
			test('Move legality 2e', function() { var p=new Chess2.Position(position2e); return legalMoves(p); }, moves2e);
			test('Move legality 2f', function() { var p=new Chess2.Position(position2f); return legalMoves(p); }, moves2f);
			test('Move legality 3a', function() { var p=new Chess2.Position(position3a); return legalMoves(p); }, moves3a);
			test('Move legality 3b', function() { var p=new Chess2.Position(position3b); return legalMoves(p); }, moves3b);
			test('Move legality 3c', function() { var p=new Chess2.Position(position3c); return legalMoves(p); }, moves3c);
			test('Move legality 4a', function() { var p=new Chess2.Position(position4a); return legalMoves(p); }, moves4a);
			test('Move legality 4b', function() { var p=new Chess2.Position(position4b); return legalMoves(p); }, moves4b);
			test('Move legality 4c', function() { var p=new Chess2.Position(position4c); return legalMoves(p); }, moves4c);
			test('Move legality 5a', function() { var p=new Chess2.Position(position5a); return legalMoves(p); }, moves5a);
			test('Move legality 5b', function() { var p=new Chess2.Position(position5b); return legalMoves(p); }, moves5b);
			test('Move legality 5c', function() { var p=new Chess2.Position(position5c); return legalMoves(p); }, moves5c);
			test('Move legality 5d', function() { var p=new Chess2.Position(position5d); return legalMoves(p); }, moves5d);
			test('Move legality 5e', function() { var p=new Chess2.Position(position5e); return legalMoves(p); }, moves5e);
			test('Move legality 5f', function() { var p=new Chess2.Position(position5f); return legalMoves(p); }, moves5f);
			test('Move legality 6a', function() { var p=new Chess2.Position(position6a); return legalMoves(p); }, moves6a);
			test('Move legality 6b', function() { var p=new Chess2.Position(position6b); return legalMoves(p); }, moves6b);
			test('Move legality 6c', function() { var p=new Chess2.Position(position6c); return legalMoves(p); }, moves6c);
			test('Move legality 6d', function() { var p=new Chess2.Position(position6d); return legalMoves(p); }, moves6d);
			test('Move legality 6e', function() { var p=new Chess2.Position(position6e); return legalMoves(p); }, moves6e);
			test('Move legality 6f', function() { var p=new Chess2.Position(position6f); return legalMoves(p); }, moves6f);
			test('Move legality 7a', function() { var p=new Chess2.Position(position7a); return legalMoves(p); }, moves7 );
			test('Move legality 7b', function() { var p=new Chess2.Position(position7b); return legalMoves(p); }, moves7 );

			// Move generation
			test('Move generation 0a', function() { var p=new Chess2.Position(          ); return generateMoves(p); }, moves0a);
			test('Move generation 0b', function() { var p=new Chess2.Position(customFEN2); return generateMoves(p); }, moves0b);
			test('Move generation 0c', function() { var p=new Chess2.Position('empty'   ); return generateMoves(p); }, moves0c);
			test('Move generation 1' , function() { var p=new Chess2.Position(position1 ); return generateMoves(p); }, moves1 );
			test('Move generation 2a', function() { var p=new Chess2.Position(position2a); return generateMoves(p); }, moves2a);
			test('Move generation 2b', function() { var p=new Chess2.Position(position2b); return generateMoves(p); }, moves2b);
			test('Move generation 2c', function() { var p=new Chess2.Position(position2c); return generateMoves(p); }, moves2c);
			test('Move generation 2d', function() { var p=new Chess2.Position(position2d); return generateMoves(p); }, moves2d);
			test('Move generation 2e', function() { var p=new Chess2.Position(position2e); return generateMoves(p); }, moves2e);
			test('Move generation 2f', function() { var p=new Chess2.Position(position2f); return generateMoves(p); }, moves2f);
			test('Move generation 3a', function() { var p=new Chess2.Position(position3a); return generateMoves(p); }, moves3a);
			test('Move generation 3b', function() { var p=new Chess2.Position(position3b); return generateMoves(p); }, moves3b);
			test('Move generation 3c', function() { var p=new Chess2.Position(position3c); return generateMoves(p); }, moves3c);
			test('Move generation 4a', function() { var p=new Chess2.Position(position4a); return generateMoves(p); }, moves4a);
			test('Move generation 4b', function() { var p=new Chess2.Position(position4b); return generateMoves(p); }, moves4b);
			test('Move generation 4c', function() { var p=new Chess2.Position(position4c); return generateMoves(p); }, moves4c);
			test('Move generation 5a', function() { var p=new Chess2.Position(position5a); return generateMoves(p); }, moves5a);
			test('Move generation 5b', function() { var p=new Chess2.Position(position5b); return generateMoves(p); }, moves5b);
			test('Move generation 5c', function() { var p=new Chess2.Position(position5c); return generateMoves(p); }, moves5c);
			test('Move generation 5d', function() { var p=new Chess2.Position(position5d); return generateMoves(p); }, moves5d);
			test('Move generation 5e', function() { var p=new Chess2.Position(position5e); return generateMoves(p); }, moves5e);
			test('Move generation 5f', function() { var p=new Chess2.Position(position5f); return generateMoves(p); }, moves5f);
			test('Move generation 6a', function() { var p=new Chess2.Position(position6a); return generateMoves(p); }, moves6a);
			test('Move generation 6b', function() { var p=new Chess2.Position(position6b); return generateMoves(p); }, moves6b);
			test('Move generation 6c', function() { var p=new Chess2.Position(position6c); return generateMoves(p); }, moves6c);
			test('Move generation 6d', function() { var p=new Chess2.Position(position6d); return generateMoves(p); }, moves6d);
			test('Move generation 6e', function() { var p=new Chess2.Position(position6e); return generateMoves(p); }, moves6e);
			test('Move generation 6f', function() { var p=new Chess2.Position(position6f); return generateMoves(p); }, moves6f);
			test('Move generation 7a', function() { var p=new Chess2.Position(position7a); return generateMoves(p); }, moves7 );
			test('Move generation 7b', function() { var p=new Chess2.Position(position7b); return generateMoves(p); }, moves7 );

			// Check/Checkmate/Stalemate
			test('Check/Checkmate/Stalemate 0a', function() { var p=new Chess2.Position(          ); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 0b', function() { var p=new Chess2.Position(customFEN2); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 0c', function() { var p=new Chess2.Position('empty'   ); return ccs(p); }, ccsIllegal  );
			test('Check/Checkmate/Stalemate 1' , function() { var p=new Chess2.Position(position1 ); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2a', function() { var p=new Chess2.Position(position2a); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2b', function() { var p=new Chess2.Position(position2b); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2c', function() { var p=new Chess2.Position(position2c); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2d', function() { var p=new Chess2.Position(position2d); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2e', function() { var p=new Chess2.Position(position2e); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 2f', function() { var p=new Chess2.Position(position2f); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 3a', function() { var p=new Chess2.Position(position3a); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 3b', function() { var p=new Chess2.Position(position3b); return ccs(p); }, ccsCheck    );
			test('Check/Checkmate/Stalemate 3c', function() { var p=new Chess2.Position(position3c); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 4a', function() { var p=new Chess2.Position(position4a); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 4b', function() { var p=new Chess2.Position(position4b); return ccs(p); }, ccsCheck    );
			test('Check/Checkmate/Stalemate 4c', function() { var p=new Chess2.Position(position4c); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 5a', function() { var p=new Chess2.Position(position5a); return ccs(p); }, ccsCheck    );
			test('Check/Checkmate/Stalemate 5b', function() { var p=new Chess2.Position(position5b); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 5c', function() { var p=new Chess2.Position(position5c); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 5d', function() { var p=new Chess2.Position(position5d); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 5e', function() { var p=new Chess2.Position(position5e); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 5f', function() { var p=new Chess2.Position(position5f); return ccs(p); }, ccsIllegal  );
			test('Check/Checkmate/Stalemate 6a', function() { var p=new Chess2.Position(position6a); return ccs(p); }, ccsCheck    );
			test('Check/Checkmate/Stalemate 6b', function() { var p=new Chess2.Position(position6b); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 6c', function() { var p=new Chess2.Position(position6c); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 6d', function() { var p=new Chess2.Position(position6d); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 6e', function() { var p=new Chess2.Position(position6e); return ccs(p); }, ccsNormal   );
			test('Check/Checkmate/Stalemate 6f', function() { var p=new Chess2.Position(position6f); return ccs(p); }, ccsIllegal  );
			test('Check/Checkmate/Stalemate 7a', function() { var p=new Chess2.Position(position7a); return ccs(p); }, ccsStalemate);
			test('Check/Checkmate/Stalemate 7b', function() { var p=new Chess2.Position(position7b); return ccs(p); }, ccsCheckmate);

			function wrapFEN(p) {
				return p.fen() + ' ' + p.isLegal() + ' ' + p.kingSquare('w') + ' ' + p.kingSquare('b');
			}

			// Play - game 1
			var g1 = new Chess2.Position();
			test('Play 1.00'        , function() {                   return wrapFEN(g1); }, 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play 1.01'        , function() { g1.play('e2e4' ); return wrapFEN(g1); }, 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1 true e1 e8');
			test('Play 1.02'        , function() { g1.play('d7d5' ); return wrapFEN(g1); }, 'rnbqkbnr/ppp1pppp/8/3p4/4P3/8/PPPP1PPP/RNBQKBNR w KQkq d6 0 1 true e1 e8');
			test('Play 1.03'        , function() { g1.play('e4d5' ); return wrapFEN(g1); }, 'rnbqkbnr/ppp1pppp/8/3P4/8/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play 1.04'        , function() { g1.play('c7c6' ); return wrapFEN(g1); }, 'rnbqkbnr/pp2pppp/2p5/3P4/8/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play 1.05'        , function() { g1.play('d5c6' ); return wrapFEN(g1); }, 'rnbqkbnr/pp2pppp/2P5/8/8/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play 1.06'        , function() { g1.play('d8d2' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pppp/2P5/8/8/8/PPPq1PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play 1.07'        , function() { g1.play('b1d2' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pppp/2P5/8/8/8/PPPN1PPP/R1BQKBNR b KQkq - 0 1 true e1 e8');
			test('Play 1.08'        , function() { g1.play('g7g5' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/6p1/8/8/PPPN1PPP/R1BQKBNR w KQkq g6 0 1 true e1 e8');
			test('Play 1.09'        , function() { g1.play('d2b1' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/6p1/8/8/PPP2PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play 1.10'        , function() { g1.play('g5g4' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/8/6p1/8/PPP2PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play 1.11'        , function() { g1.play('h2h4' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/8/6pP/8/PPP2PP1/RNBQKBNR b KQkq h3 0 1 true e1 e8');
			test('Play 1.12 (ep)'   , function() { g1.play('g4h3' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/8/8/7p/PPP2PP1/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play 1.13'        , function() { g1.play('h1h3' ); return wrapFEN(g1); }, 'rnb1kbnr/pp2pp1p/2P5/8/8/7R/PPP2PP1/RNBQKBN1 b Qkq - 0 1 true e1 e8');
			test('Play 1.14'        , function() { g1.play('c8f5' ); return wrapFEN(g1); }, 'rn2kbnr/pp2pp1p/2P5/5b2/8/7R/PPP2PP1/RNBQKBN1 w Qkq - 0 1 true e1 e8');
			test('Play 1.15'        , function() { g1.play('c6b7' ); return wrapFEN(g1); }, 'rn2kbnr/pP2pp1p/8/5b2/8/7R/PPP2PP1/RNBQKBN1 b Qkq - 0 1 true e1 e8');
			test('Play 1.16'        , function() { g1.play('f5c2' ); return wrapFEN(g1); }, 'rn2kbnr/pP2pp1p/8/8/8/7R/PPb2PP1/RNBQKBN1 w Qkq - 0 1 true e1 e8');
			test('Play 1.17 (promo)', function() { g1.play('b7a8Q'); return wrapFEN(g1); }, 'Qn2kbnr/p3pp1p/8/8/8/7R/PPb2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play 1.18'        , function() { g1.play('f8g7' ); return wrapFEN(g1); }, 'Qn2k1nr/p3ppbp/8/8/8/7R/PPb2PP1/RNBQKBN1 w Qk - 0 1 true e1 e8');
			test('Play 1.19'        , function() { g1.play('b2b4' ); return wrapFEN(g1); }, 'Qn2k1nr/p3ppbp/8/8/1P6/7R/P1b2PP1/RNBQKBN1 b Qk b3 0 1 true e1 e8');
			test('Play 1.20'        , function() { g1.play('g8f6' ); return wrapFEN(g1); }, 'Qn2k2r/p3ppbp/5n2/8/1P6/7R/P1b2PP1/RNBQKBN1 w Qk - 0 1 true e1 e8');
			test('Play 1.21'        , function() { g1.play('b4b5' ); return wrapFEN(g1); }, 'Qn2k2r/p3ppbp/5n2/1P6/8/7R/P1b2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play 1.22'        , function() { g1.play('a7a5' ); return wrapFEN(g1); }, 'Qn2k2r/4ppbp/5n2/pP6/8/7R/P1b2PP1/RNBQKBN1 w Qk a6 0 1 true e1 e8');
			test('Play 1.23 (ep)'   , function() { g1.play('b5a6' ); return wrapFEN(g1); }, 'Qn2k2r/4ppbp/P4n2/8/8/7R/P1b2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play 1.24 (O-O)'  , function() { g1.play('e8g8' ); return wrapFEN(g1); }, 'Qn3rk1/4ppbp/P4n2/8/8/7R/P1b2PP1/RNBQKBN1 w Q - 0 1 true e1 g8');
			test('Play 1.25'        , function() { g1.play('e1d2' ); return wrapFEN(g1); }, 'Qn3rk1/4ppbp/P4n2/8/8/7R/P1bK1PP1/RNBQ1BN1 b - - 0 1 true d2 g8');
			test('Play 1.26'        , function() { g1.play('e7e5' ); return wrapFEN(g1); }, 'Qn3rk1/5pbp/P4n2/4p3/8/7R/P1bK1PP1/RNBQ1BN1 w - e6 0 1 true d2 g8');
			test('Play 1.27'        , function() { g1.play('d2c2' ); return wrapFEN(g1); }, 'Qn3rk1/5pbp/P4n2/4p3/8/7R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play 1.28'        , function() { g1.play('e5e4' ); return wrapFEN(g1); }, 'Qn3rk1/5pbp/P4n2/8/4p3/7R/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play 1.29'        , function() { g1.play('a8d5' ); return wrapFEN(g1); }, '1n3rk1/5pbp/P4n2/3Q4/4p3/7R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play 1.30'        , function() { g1.play('e4e3' ); return wrapFEN(g1); }, '1n3rk1/5pbp/P4n2/3Q4/8/4p2R/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play 1.31'        , function() { g1.play('a6a7' ); return wrapFEN(g1); }, '1n3rk1/P4pbp/5n2/3Q4/8/4p2R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play 1.32'        , function() { g1.play('e3e2' ); return wrapFEN(g1); }, '1n3rk1/P4pbp/5n2/3Q4/8/7R/P1K1pPP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play 1.33 (promo)', function() { g1.play('a7a8N'); return wrapFEN(g1); }, 'Nn3rk1/5pbp/5n2/3Q4/8/7R/P1K1pPP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play 1.34 (promo)', function() { g1.play('e2e1B'); return wrapFEN(g1); }, 'Nn3rk1/5pbp/5n2/3Q4/8/7R/P1K2PP1/RNBQbBN1 w - - 0 1 true c2 g8');
			test('Play 1.35'        , function() { g1.play('d5f7' ); return wrapFEN(g1); }, 'Nn3rk1/5Qbp/5n2/8/8/7R/P1K2PP1/RNBQbBN1 b - - 0 1 true c2 g8');
			test('Play 1.36'        , function() { g1.play('g8h8' ); return wrapFEN(g1); }, 'Nn3r1k/5Qbp/5n2/8/8/7R/P1K2PP1/RNBQbBN1 w - - 0 1 true c2 h8');
			test('Play 1.37'        , function() { g1.play('h3g3' ); return wrapFEN(g1); }, 'Nn3r1k/5Qbp/5n2/8/8/6R1/P1K2PP1/RNBQbBN1 b - - 0 1 true c2 h8');
			test('Play 1.38'        , function() { g1.play('e1b4' ); return wrapFEN(g1); }, 'Nn3r1k/5Qbp/5n2/8/1b6/6R1/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 h8');
			test('Play 1.39'        , function() { g1.play('f7g7' ); return wrapFEN(g1); }, 'Nn3r1k/6Qp/5n2/8/1b6/6R1/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 h8');

			// Play - game 2
			var g2a = new Chess2.Position('r3k2r/8/8/8/8/8/8/R3K2R w KQkq - 0 1');
			var g2b = new Chess2.Position('r3k2r/8/8/8/8/8/8/R3K2R b KQkq - 0 1');
			var g2c = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR w KQkq - 0 1');
			var g2d = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR w KQkq - 0 1');
			var g2e = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR b KQkq - 0 1');
			var g2f = new Chess2.Position('r3k2r/8/8/3BB3/3bb3/8/8/R3K2R w KQkq - 0 1');
			test('Play 2a.1', function() { g2a.play('e1g1'); return wrapFEN(g2a); }, 'r3k2r/8/8/8/8/8/8/R4RK1 b kq - 0 1 true g1 e8');
			test('Play 2a.2', function() { g2a.play('e8c8'); return wrapFEN(g2a); }, '2kr3r/8/8/8/8/8/8/R4RK1 w - - 0 1 true g1 c8');
			test('Play 2b.1', function() { g2b.play('e8g8'); return wrapFEN(g2b); }, 'r4rk1/8/8/8/8/8/8/R3K2R w KQ - 0 1 true e1 g8');
			test('Play 2b.2', function() { g2b.play('e1c1'); return wrapFEN(g2b); }, 'r4rk1/8/8/8/8/8/8/2KR3R b - - 0 1 true c1 g8');
			test('Play 2c.1', function() { g2c.play('h1h8'); return wrapFEN(g2c); }, 'rn2k1nR/8/8/8/8/8/8/RN2K1N1 b Qq - 0 1 true e1 e8');
			test('Play 2c.2', function() { g2c.play('a8a1'); return wrapFEN(g2c); }, '1n2k1nR/8/8/8/8/8/8/rN2K1N1 w - - 0 1 true e1 e8');
			test('Play 2d.1', function() { g2d.play('a1a8'); return wrapFEN(g2d); }, 'Rn2k1nr/8/8/8/8/8/8/1N2K1NR b Kk - 0 1 true e1 e8');
			test('Play 2d.2', function() { g2d.play('h8h1'); return wrapFEN(g2d); }, 'Rn2k1n1/8/8/8/8/8/8/1N2K1Nr w - - 0 1 true e1 e8');
			test('Play 2e.1', function() { g2e.play('a8a5'); return wrapFEN(g2e); }, '1n2k1nr/8/8/r7/8/8/8/RN2K1NR w KQk - 0 1 true e1 e8');
			test('Play 2e.2', function() { g2e.play('a1a4'); return wrapFEN(g2e); }, '1n2k1nr/8/8/r7/R7/8/8/1N2K1NR b Kk - 0 1 true e1 e8');
			test('Play 2e.3', function() { g2e.play('h8h5'); return wrapFEN(g2e); }, '1n2k1n1/8/8/r6r/R7/8/8/1N2K1NR w K - 0 1 true e1 e8');
			test('Play 2e.4', function() { g2e.play('h1h4'); return wrapFEN(g2e); }, '1n2k1n1/8/8/r6r/R6R/8/8/1N2K1N1 b - - 0 1 true e1 e8');
			test('Play 2f.1', function() { g2f.play('e5h8'); return wrapFEN(g2f); }, 'r3k2B/8/8/3B4/3bb3/8/8/R3K2R b KQq - 0 1 true e1 e8');
			test('Play 2f.2', function() { g2f.play('d4a1'); return wrapFEN(g2f); }, 'r3k2B/8/8/3B4/4b3/8/8/b3K2R w Kq - 0 1 true e1 e8');
			test('Play 2f.3', function() { g2f.play('d5a8'); return wrapFEN(g2f); }, 'B3k2B/8/8/8/4b3/8/8/b3K2R b K - 0 1 true e1 e8');
			test('Play 2f.4', function() { g2f.play('e4h1'); return wrapFEN(g2f); }, 'B3k2B/8/8/8/8/8/8/b3K2b w - - 0 1 true e1 e8');

			function playDescriptor(p, move) {
				var moves = p.moves();
				for(var i=0; i<moves.length; ++i) {
					if(moves[i].toString() === move) {
						p.play(moves[i]);
						return;
					}
				}
			}

			// Play with move descriptor - game 3
			var g3 = new Chess2.Position();
			test('Play descriptor 3.00'        , function() {                                return wrapFEN(g3); }, 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.01'        , function() { playDescriptor(g3, 'e2e4' ); return wrapFEN(g3); }, 'rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1 true e1 e8');
			test('Play descriptor 3.02'        , function() { playDescriptor(g3, 'd7d5' ); return wrapFEN(g3); }, 'rnbqkbnr/ppp1pppp/8/3p4/4P3/8/PPPP1PPP/RNBQKBNR w KQkq d6 0 1 true e1 e8');
			test('Play descriptor 3.03'        , function() { playDescriptor(g3, 'e4d5' ); return wrapFEN(g3); }, 'rnbqkbnr/ppp1pppp/8/3P4/8/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.04'        , function() { playDescriptor(g3, 'c7c6' ); return wrapFEN(g3); }, 'rnbqkbnr/pp2pppp/2p5/3P4/8/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.05'        , function() { playDescriptor(g3, 'd5c6' ); return wrapFEN(g3); }, 'rnbqkbnr/pp2pppp/2P5/8/8/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.06'        , function() { playDescriptor(g3, 'd8d2' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pppp/2P5/8/8/8/PPPq1PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.07'        , function() { playDescriptor(g3, 'b1d2' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pppp/2P5/8/8/8/PPPN1PPP/R1BQKBNR b KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.08'        , function() { playDescriptor(g3, 'g7g5' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/6p1/8/8/PPPN1PPP/R1BQKBNR w KQkq g6 0 1 true e1 e8');
			test('Play descriptor 3.09'        , function() { playDescriptor(g3, 'd2b1' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/6p1/8/8/PPP2PPP/RNBQKBNR b KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.10'        , function() { playDescriptor(g3, 'g5g4' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/8/6p1/8/PPP2PPP/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.11'        , function() { playDescriptor(g3, 'h2h4' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/8/6pP/8/PPP2PP1/RNBQKBNR b KQkq h3 0 1 true e1 e8');
			test('Play descriptor 3.12 (ep)'   , function() { playDescriptor(g3, 'g4h3' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/8/8/7p/PPP2PP1/RNBQKBNR w KQkq - 0 1 true e1 e8');
			test('Play descriptor 3.13'        , function() { playDescriptor(g3, 'h1h3' ); return wrapFEN(g3); }, 'rnb1kbnr/pp2pp1p/2P5/8/8/7R/PPP2PP1/RNBQKBN1 b Qkq - 0 1 true e1 e8');
			test('Play descriptor 3.14'        , function() { playDescriptor(g3, 'c8f5' ); return wrapFEN(g3); }, 'rn2kbnr/pp2pp1p/2P5/5b2/8/7R/PPP2PP1/RNBQKBN1 w Qkq - 0 1 true e1 e8');
			test('Play descriptor 3.15'        , function() { playDescriptor(g3, 'c6b7' ); return wrapFEN(g3); }, 'rn2kbnr/pP2pp1p/8/5b2/8/7R/PPP2PP1/RNBQKBN1 b Qkq - 0 1 true e1 e8');
			test('Play descriptor 3.16'        , function() { playDescriptor(g3, 'f5c2' ); return wrapFEN(g3); }, 'rn2kbnr/pP2pp1p/8/8/8/7R/PPb2PP1/RNBQKBN1 w Qkq - 0 1 true e1 e8');
			test('Play descriptor 3.17 (promo)', function() { playDescriptor(g3, 'b7a8Q'); return wrapFEN(g3); }, 'Qn2kbnr/p3pp1p/8/8/8/7R/PPb2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play descriptor 3.18'        , function() { playDescriptor(g3, 'f8g7' ); return wrapFEN(g3); }, 'Qn2k1nr/p3ppbp/8/8/8/7R/PPb2PP1/RNBQKBN1 w Qk - 0 1 true e1 e8');
			test('Play descriptor 3.19'        , function() { playDescriptor(g3, 'b2b4' ); return wrapFEN(g3); }, 'Qn2k1nr/p3ppbp/8/8/1P6/7R/P1b2PP1/RNBQKBN1 b Qk b3 0 1 true e1 e8');
			test('Play descriptor 3.20'        , function() { playDescriptor(g3, 'g8f6' ); return wrapFEN(g3); }, 'Qn2k2r/p3ppbp/5n2/8/1P6/7R/P1b2PP1/RNBQKBN1 w Qk - 0 1 true e1 e8');
			test('Play descriptor 3.21'        , function() { playDescriptor(g3, 'b4b5' ); return wrapFEN(g3); }, 'Qn2k2r/p3ppbp/5n2/1P6/8/7R/P1b2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play descriptor 3.22'        , function() { playDescriptor(g3, 'a7a5' ); return wrapFEN(g3); }, 'Qn2k2r/4ppbp/5n2/pP6/8/7R/P1b2PP1/RNBQKBN1 w Qk a6 0 1 true e1 e8');
			test('Play descriptor 3.23 (ep)'   , function() { playDescriptor(g3, 'b5a6' ); return wrapFEN(g3); }, 'Qn2k2r/4ppbp/P4n2/8/8/7R/P1b2PP1/RNBQKBN1 b Qk - 0 1 true e1 e8');
			test('Play descriptor 3.24 (O-O)'  , function() { playDescriptor(g3, 'e8g8' ); return wrapFEN(g3); }, 'Qn3rk1/4ppbp/P4n2/8/8/7R/P1b2PP1/RNBQKBN1 w Q - 0 1 true e1 g8');
			test('Play descriptor 3.25'        , function() { playDescriptor(g3, 'e1d2' ); return wrapFEN(g3); }, 'Qn3rk1/4ppbp/P4n2/8/8/7R/P1bK1PP1/RNBQ1BN1 b - - 0 1 true d2 g8');
			test('Play descriptor 3.26'        , function() { playDescriptor(g3, 'e7e5' ); return wrapFEN(g3); }, 'Qn3rk1/5pbp/P4n2/4p3/8/7R/P1bK1PP1/RNBQ1BN1 w - e6 0 1 true d2 g8');
			test('Play descriptor 3.27'        , function() { playDescriptor(g3, 'd2c2' ); return wrapFEN(g3); }, 'Qn3rk1/5pbp/P4n2/4p3/8/7R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play descriptor 3.28'        , function() { playDescriptor(g3, 'e5e4' ); return wrapFEN(g3); }, 'Qn3rk1/5pbp/P4n2/8/4p3/7R/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play descriptor 3.29'        , function() { playDescriptor(g3, 'a8d5' ); return wrapFEN(g3); }, '1n3rk1/5pbp/P4n2/3Q4/4p3/7R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play descriptor 3.30'        , function() { playDescriptor(g3, 'e4e3' ); return wrapFEN(g3); }, '1n3rk1/5pbp/P4n2/3Q4/8/4p2R/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play descriptor 3.31'        , function() { playDescriptor(g3, 'a6a7' ); return wrapFEN(g3); }, '1n3rk1/P4pbp/5n2/3Q4/8/4p2R/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play descriptor 3.32'        , function() { playDescriptor(g3, 'e3e2' ); return wrapFEN(g3); }, '1n3rk1/P4pbp/5n2/3Q4/8/7R/P1K1pPP1/RNBQ1BN1 w - - 0 1 true c2 g8');
			test('Play descriptor 3.33 (promo)', function() { playDescriptor(g3, 'a7a8N'); return wrapFEN(g3); }, 'Nn3rk1/5pbp/5n2/3Q4/8/7R/P1K1pPP1/RNBQ1BN1 b - - 0 1 true c2 g8');
			test('Play descriptor 3.34 (promo)', function() { playDescriptor(g3, 'e2e1B'); return wrapFEN(g3); }, 'Nn3rk1/5pbp/5n2/3Q4/8/7R/P1K2PP1/RNBQbBN1 w - - 0 1 true c2 g8');
			test('Play descriptor 3.35'        , function() { playDescriptor(g3, 'd5f7' ); return wrapFEN(g3); }, 'Nn3rk1/5Qbp/5n2/8/8/7R/P1K2PP1/RNBQbBN1 b - - 0 1 true c2 g8');
			test('Play descriptor 3.36'        , function() { playDescriptor(g3, 'g8h8' ); return wrapFEN(g3); }, 'Nn3r1k/5Qbp/5n2/8/8/7R/P1K2PP1/RNBQbBN1 w - - 0 1 true c2 h8');
			test('Play descriptor 3.37'        , function() { playDescriptor(g3, 'h3g3' ); return wrapFEN(g3); }, 'Nn3r1k/5Qbp/5n2/8/8/6R1/P1K2PP1/RNBQbBN1 b - - 0 1 true c2 h8');
			test('Play descriptor 3.38'        , function() { playDescriptor(g3, 'e1b4' ); return wrapFEN(g3); }, 'Nn3r1k/5Qbp/5n2/8/1b6/6R1/P1K2PP1/RNBQ1BN1 w - - 0 1 true c2 h8');
			test('Play descriptor 3.39'        , function() { playDescriptor(g3, 'f7g7' ); return wrapFEN(g3); }, 'Nn3r1k/6Qp/5n2/8/1b6/6R1/P1K2PP1/RNBQ1BN1 b - - 0 1 true c2 h8');

			// Play with move descriptor - game 4
			var g4a = new Chess2.Position('r3k2r/8/8/8/8/8/8/R3K2R w KQkq - 0 1');
			var g4b = new Chess2.Position('r3k2r/8/8/8/8/8/8/R3K2R b KQkq - 0 1');
			var g4c = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR w KQkq - 0 1');
			var g4d = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR w KQkq - 0 1');
			var g4e = new Chess2.Position('rn2k1nr/8/8/8/8/8/8/RN2K1NR b KQkq - 0 1');
			var g4f = new Chess2.Position('r3k2r/8/8/3BB3/3bb3/8/8/R3K2R w KQkq - 0 1');
			test('Play descriptor 4a.1', function() { playDescriptor(g4a, 'e1g1'); return wrapFEN(g4a); }, 'r3k2r/8/8/8/8/8/8/R4RK1 b kq - 0 1 true g1 e8');
			test('Play descriptor 4a.2', function() { playDescriptor(g4a, 'e8c8'); return wrapFEN(g4a); }, '2kr3r/8/8/8/8/8/8/R4RK1 w - - 0 1 true g1 c8');
			test('Play descriptor 4b.1', function() { playDescriptor(g4b, 'e8g8'); return wrapFEN(g4b); }, 'r4rk1/8/8/8/8/8/8/R3K2R w KQ - 0 1 true e1 g8');
			test('Play descriptor 4b.2', function() { playDescriptor(g4b, 'e1c1'); return wrapFEN(g4b); }, 'r4rk1/8/8/8/8/8/8/2KR3R b - - 0 1 true c1 g8');
			test('Play descriptor 4c.1', function() { playDescriptor(g4c, 'h1h8'); return wrapFEN(g4c); }, 'rn2k1nR/8/8/8/8/8/8/RN2K1N1 b Qq - 0 1 true e1 e8');
			test('Play descriptor 4c.2', function() { playDescriptor(g4c, 'a8a1'); return wrapFEN(g4c); }, '1n2k1nR/8/8/8/8/8/8/rN2K1N1 w - - 0 1 true e1 e8');
			test('Play descriptor 4d.1', function() { playDescriptor(g4d, 'a1a8'); return wrapFEN(g4d); }, 'Rn2k1nr/8/8/8/8/8/8/1N2K1NR b Kk - 0 1 true e1 e8');
			test('Play descriptor 4d.2', function() { playDescriptor(g4d, 'h8h1'); return wrapFEN(g4d); }, 'Rn2k1n1/8/8/8/8/8/8/1N2K1Nr w - - 0 1 true e1 e8');
			test('Play descriptor 4e.1', function() { playDescriptor(g4e, 'a8a5'); return wrapFEN(g4e); }, '1n2k1nr/8/8/r7/8/8/8/RN2K1NR w KQk - 0 1 true e1 e8');
			test('Play descriptor 4e.2', function() { playDescriptor(g4e, 'a1a4'); return wrapFEN(g4e); }, '1n2k1nr/8/8/r7/R7/8/8/1N2K1NR b Kk - 0 1 true e1 e8');
			test('Play descriptor 4e.3', function() { playDescriptor(g4e, 'h8h5'); return wrapFEN(g4e); }, '1n2k1n1/8/8/r6r/R7/8/8/1N2K1NR w K - 0 1 true e1 e8');
			test('Play descriptor 4e.4', function() { playDescriptor(g4e, 'h1h4'); return wrapFEN(g4e); }, '1n2k1n1/8/8/r6r/R6R/8/8/1N2K1N1 b - - 0 1 true e1 e8');
			test('Play descriptor 4f.1', function() { playDescriptor(g4f, 'e5h8'); return wrapFEN(g4f); }, 'r3k2B/8/8/3B4/3bb3/8/8/R3K2R b KQq - 0 1 true e1 e8');
			test('Play descriptor 4f.2', function() { playDescriptor(g4f, 'd4a1'); return wrapFEN(g4f); }, 'r3k2B/8/8/3B4/4b3/8/8/b3K2R w Kq - 0 1 true e1 e8');
			test('Play descriptor 4f.3', function() { playDescriptor(g4f, 'd5a8'); return wrapFEN(g4f); }, 'B3k2B/8/8/8/4b3/8/8/b3K2R b K - 0 1 true e1 e8');
			test('Play descriptor 4f.4', function() { playDescriptor(g4f, 'e4h1'); return wrapFEN(g4f); }, 'B3k2B/8/8/8/8/8/8/b3K2b w - - 0 1 true e1 e8');

			function nullMoveInfo(p) {
				return p.isLegal() + ':' + p.isNullMoveLegal();
			}

			// Null-moves
			test('Null move 1', function() { var p=new Chess2.Position(); return nullMoveInfo(p); }, 'true:true');
			test('Null move 2', function() { var p=new Chess2.Position('8/8/8/Kr5k/8/8/8/8 w - - 0 1'); return nullMoveInfo(p); }, 'true:false');
			test('Null move 3', function() { var p=new Chess2.Position('8/8/8/Kr5k/8/8/8/8 b - - 0 1'); return nullMoveInfo(p); }, 'false:false');
			test('Play null move', function() { var p=new Chess2.Position('4k3/8/8/4p3/4P3/8/8/4K3 w - e6 0 1'); p.playNullMove(); return wrapFEN(p); }, '4k3/8/8/4p3/4P3/8/8/4K3 b - - 0 1 true e1 e8');
		};
	</script>

</body>

</html>
